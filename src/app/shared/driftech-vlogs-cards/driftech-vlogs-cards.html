<!-- Grid Container for Vlogs -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">

  <!-- Individual Vlog Card -->
  <div *ngFor="let vlog of vlogsWithThumbnails"
    class="group relative cursor-pointer overflow-hidden rounded-2xl shadow-lg transition-all duration-300 hover:shadow-2xl hover:scale-[1.02]"
    (click)="openVideo(vlog)" (keydown)="onKeydown($event)" tabindex="0" role="button"
    [attr.aria-label]="'Play video: ' + vlog.title">

    <!-- Thumbnail Container -->
    <div class="relative w-full h-64 sm:h-72 lg:h-80 bg-gray-900 overflow-hidden rounded-t-2xl">

      <!-- Loading Spinner -->
      <div *ngIf="vlog.isLoading"
        class="absolute inset-0 flex flex-col items-center justify-center bg-gray-900 bg-opacity-70">
        <div class="animate-spin rounded-full h-10 w-10 border-b-4 border-orange-500 mb-2"></div>
        <span class="text-white text-sm">Loading...</span>
      </div>

      <!-- Thumbnail Image -->
      <img *ngIf="!vlog.isLoading && !vlog.hasError" [src]="vlog.thumbnail || defaultThumbnail"
        [alt]="vlog.title + ' thumbnail'"
        class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
        (load)="onThumbnailLoad(vlog)" (error)="onThumbnailError(vlog)" />

      <!-- Duration badge -->
      <div *ngIf="vlog.duration && !vlog.isLoading"
        class="absolute bottom-3 right-3 bg-black bg-opacity-70 text-white text-xs px-3 py-1 rounded-lg font-semibold backdrop-blur-sm">
        {{ vlog.duration }}
      </div>

      <!-- Play button overlay -->
      <div
        class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300">
        <div class="transform scale-75 group-hover:scale-110 transition-all duration-300">
          <svg class="w-16 h-16 text-white drop-shadow-lg opacity-90 group-hover:opacity-100" fill="currentColor"
            viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z" />
          </svg>
        </div>
      </div>
    </div>

    <!-- Title + description overlay -->
    <div class="p-4 bg-gradient-to-t from-black/70 to-transparent absolute bottom-0 w-full">
      <h3
        class="text-white font-bold text-lg sm:text-xl line-clamp-2 group-hover:text-orange-500 transition-colors duration-300">
        {{ vlog.title | titlecase }}
      </h3>
    </div>
  </div>
</div>

<!-- Hidden Video Elements for Extracting Thumbnails (only for videos without thumbnails) -->
<div class="hidden">
  <ng-container *ngFor="let vlog of vlogsWithThumbnails">
    <video *ngIf="!vlog.thumbnail" [attr.data-vlog-id]="vlog.id" [src]="vlog.videoUrl || vlog.video_url || vlog.link"
      muted playsinline preload="metadata" (loadedmetadata)="extractThumbnailFromElement($event.target, vlog)"
      (error)="onVideoError(vlog)"></video>
  </ng-container>
</div>

<!-- Video Modal -->
<div *ngIf="selectedVideo" #videoModal
  class="fixed inset-0 z-[99999999999999999] flex items-center justify-center water-effect bg-black/50 backdrop-blur-sm"
  (click)="closeVideo()" (keydown)="onKeydown($event)" tabindex="-1" role="dialog" aria-modal="true"
  aria-labelledby="video-title">

  <div class="relative max-w-4xl w-full mx-4 bg-white rounded-2xl overflow-hidden shadow-2xl min-h-[80vh]"
    (click)="$event.stopPropagation()">

    <!-- Close Button -->
    <button (click)="closeVideo()"
      class="absolute top-4 right-4 z-10 bg-black bg-opacity-50 hover:bg-opacity-70 text-white rounded-full p-2 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-orange-500"
      aria-label="Close video">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <!-- Video Player -->
    <video class="w-full h-auto max-h-[70vh] min-h-[50vh]"
      [src]="selectedVideo.videoUrl || selectedVideo.video_url || selectedVideo.link" controls autoplay playsinline
      [poster]="selectedVideo.thumbnail">
      Your browser does not support the video tag.
    </video>

    <!-- Video Info -->
    <div class="p-6">
      <h3 id="video-title" class="text-2xl font-bold text-gray-900 mb-3">
        {{ selectedVideo.title | titlecase }}
      </h3>
      <p *ngIf="selectedVideo.description" class="text-gray-600 leading-relaxed">
        {{ selectedVideo.description }}
      </p>
    </div>
  </div>
</div>

<!-- Screen reader accessibility -->
<div class="sr-only" aria-live="polite" aria-atomic="true">
  <span *ngIf="selectedVideo">Now playing: {{ selectedVideo.title }}</span>
</div>